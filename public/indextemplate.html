<!doctype html>
<html>
  <head>
    <title>WebSocket echo test</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <script>    
      var open = false
        , lastMessage;

      window.onload = function () {
        // create socket
        var ws = new WebSocket('ws://localhost:3000');
        ws.onopen = function () {
          open = true;
          ws.gameName = 'The Game';
          ws.send( ws.gameName );
        };
        ws.onmessage = function ( env ) {
        	if( env.data == ws.gameName ){
        		ws.send( ws.gameName );
        	} else {
        		document.getElementById('data').innerHTML = env.data;
        	}
          	
        };

		// attach listeners to login form
        document.getElementById('menueLogin').onclick = function () {
          document.getElementById('login').style.visibility='visible';
        };
        
        document.getElementById('loginCancel').onclick = function () {
          document.getElementById('loginUsername').value='';
          document.getElementById('loginPassword').value='';
          document.getElementById('login').style.visibility='hidden';
        };
        
        document.getElementById('loginForm').onsubmit = function (){
	      var usr = document.getElementById('loginUsername').value;
		  var pw = document.getElementById('loginPassword').value;
		  alert("Login als " + usr + "\nPasswort: " + pw );
		  document.getElementById('login').style.visibility='hidden';
        };
        
      };
    </script>
  </head>
  <body>
  	<div id="wrapper">
        <div id="headerwrap">
	        <div id="header">
	            <span class="mrTitle">Mixed Reality Web Graphics</span>
	        </div>
        </div>
        <div id="navigationwrap">
	        <div id="navigation">
	        	<!-- MENUE START -->
	            <span class="button menueItemActive" id="menueGames">Games</span>
	            <span class="button" id="menueAdmin">Admin</span>
	            <span class="menueSeperator"> </span>
	            <span class="button" id="menueLogin">Login</span>
	            <!-- MENUE END -->
	        </div>
        </div>
        <div id="contentwrap">
	        <div id="content">
	        	<!-- CONTENT BEGIN -->
	        	<div class="list", id="gameControl">
        			<span class="listEntry">
        				<span class="listEntryElement gameInfoHeader">Maus 03 : 01 Elefant<span>Time: 05:47</span></span>
        				<span class="button" id="gameStartStop">Start</span>
        				<span class="button" id="gameRequestTimeout">Timeout</span>
        			</span>
        		</div>
	        	<canvas class="game" id="game"></canvas>
	        	<div class="list", id="gameInfo">
	        		Game is running ...
	        	</div>
	        	
	        	<script>
	        	
	        		var TEAM_NONE = 0;
	        		var TEAM_YELLOW = 1;
	        		var TEAM_BLUE = 2;
	        		var PLAYER_WIDTH = 0.05;
	        		var BALL_WIDTH = PLAYER_WIDTH*0.5;
	        		
	        		var TO_RADIANS = Math.PI/180;
	        		var FONT_CFG = "normal 14pt Arial";
	        		var DOT_WIDTH = 5;
	        		var LINE_WIDTH = 2;
	        	
	        		/**
	        		* Draws a player marker
	        		* @param x		Center-x-position
	        		* @param y		Center-y-position
	        		* @param angle	Angle ind degree of player
	        		* @param name	Name of the player
	        		* @param team	Team of the player. Could be TEAM_NONE, TEAM_YELLOW or TEAM_BLUE
	        		*/
	        		function drawPlayer(x, y, angle, name, team){	        			
					    // create image object
					    var img = new Image();
		
					 	// get canvas elements
						var canvas = document.getElementById('game');
						var ctx = canvas.getContext('2d');
						var h = canvas.height;
						    
					    // get player size
					    var pSize = Math.round(h * PLAYER_WIDTH);
					    
				    	// save context
					    ctx.save();
					    
					    // translate and rotate context
					    ctx.translate( x, y );
					    ctx.rotate( angle * TO_RADIANS );	
					    
					    // draw image
					    if( team == TEAM_YELLOW ){
					    	img.src = "img/playeryellow.gif";
					    }
					    else if( team == TEAM_BLUE ){ drawBall
					    	img.src = "img/playerblue.gif";
					    }
					    else{
					    	img.src = "img/playernone.gif";
					    }
					    ctx.drawImage( img, -pSize*0.5, -pSize*0.5, pSize, pSize );
					    
					    // draw bot name
					    ctx.font = FONT_CFG;
					    ctx.fillStyle = "#555555";
					    ctx.textBaseline = "top"; 
					    ctx.fillText( name, -pSize*0.5, pSize*0.5+3 );
					    
					    // restore context
					    ctx.restore();  
	        		};
	        		
	        		/**
	        		* Draws the ball image
	        		* @param x	Center-x-position
	        		* @param y	Center-y-position
	        		*/
	        		function drawBall(x, y){
	        			// get canvas elements
					    var canvas = document.getElementById('game');
					    var ctx = canvas.getContext('2d');
	        			
					    // create image object
					    var img = new Image();
		
					 	// get canvas elements
						var canvas = document.getElementById('game');
						var ctx = canvas.getContext('2d');
						var h = canvas.height;
						    
					    // get player size
					    var bSize = Math.round(h * BALL_WIDTH);
					    
				    	// save context
					    ctx.save();
					    
					    // translate and rotate context
					    ctx.translate( x, y );
					    
					    // draw image
					    img.src = "img/ball.png"
					    ctx.drawImage( img, -bSize*0.5, -bSize*0.5, bSize, bSize );
					    
					    // restore context
					    ctx.restore();  
	        		};
	        		
	        		/**
	        		* Draws a line
	        		* @param start	Array (x,y) of start position
	        		* @param end	Array (x,y) of end position
	        		*/
	        		function drawLine(start, end){
	        			// get canvas elements
					    var canvas = document.getElementById('game');
					    var ctx = canvas.getContext('2d');
					    
					 	// drawing line
					    ctx.beginPath();
					    ctx.moveTo(start[0], start[1]);
					    ctx.lineTo(end[0], end[1]);
					    ctx.lineWidth = LINE_WIDTH;
					    ctx.lineCap = 'round';				    
					    ctx.strokeStyle = '#FFFFFF';
					    ctx.stroke();
	        		};
	        		
	        		/**
	        		* Draws a dot or arc
	        		* @param x		Center-x-position
	        		* @param y		Center-y-position
	        		* @param radius	Radius of arc in pixel.
	        		*				If set a arc instead of a dot is drawn
	        		*/
	        		function drawArc(x, y, radius){
	        			// get canvas elements
					    var canvas = document.getElementById('game');
					    var ctx = canvas.getContext('2d');
					    
					    ctx.beginPath();
					    if( !radius ){
					    	ctx.arc( x, y, DOT_WIDTH, 0, 2*Math.PI, false );
					    	ctx.fillStyle = '#FFFFFF';
					    	ctx.fill();
					    }
					    else{
					    	ctx.arc( x, y, radius, 0, 2*Math.PI, false );
						    ctx.lineWidth = LINE_WIDTH;
						    ctx.strokeStyle = "#FFFFFF";
						    ctx.stroke();
					    }
	        		};
	        		
	        		/**
	        		* Draws a rectangle
	        		* @param x		Top-Left-x-position
	        		* @param y		Top-Left-y-position
	        		* @param w		Width
	        		* @param h		Height
	        		* @param color	Fill color
	        		*/
	        		function drawRectangle(x, y, w, h, color){
	        			// get canvas elements
					    var canvas = document.getElementById('game');
					    var ctx = canvas.getContext('2d');
					    
					    if(!color){
					    	color = "gray";
					    }
					    
					    ctx.beginPath();
					    ctx.rect( x, y, w, h );
					    ctx.fillStyle = color;
					    ctx.fill(); 
	        		}
	        		
	        		/**
	        		* Clears canvas
	        		*/
	        		function clearCanvas(){
	        			// get canvas elements
					    var canvas = document.getElementById('game');
					    var ctx = canvas.getContext('2d');
					    
					    // clear canvas
					    ctx.clearRect(0, 0, canvas.width, canvas.height);	        			
	        		}
	        		
	        		/**
	        		* Updates size of canvas
	        		* @return Array (w,h) of new canvas size
	        		*/
	        		function updateCanvasSize(){
	        			// get canvas elements
					    var canvas = document.getElementById('game');
					    var ctx = canvas.getContext('2d');
					    
					    // update canvas size
					    var h = document.getElementById('game').scrollWidth;
					    //var w = document.getElementById('game').scrollHeight;
					    var w = h * 1.33;
					    //var h = Math.round(w * 0.75);
					    canvas.width = w;
					    canvas.height = h;
					    
					    return new Array(w, h);
	        		}
	        		
	        		/**
	        		* Updates canvas
	        		* @param wdata	Worlddata
	        		* @return True if successfull updated
	        		*/
	        		function updateCanvas(wdata){
	        			
	        			var canvas = document.getElementById('game');
	        		    if(!canvas){
	        		    	return false;
	        		    }
				    
					    // clear canvas
					    clearCanvas();
					    
					    // update canvas size
					    var cSize = updateCanvasSize();
					    var w = cSize[0];
					    var h = cSize[1];
					
					 	// drawing line
					 	drawLine( new Array(0.5*w, 0.05*h), new Array(0.5*w, (1-0.05)*h) )
					    
					    // drawing dot
					    drawArc(0.5*w, 0.5*h);
					    
					    // draw arc
					    drawArc(0.5*w, 0.5*h, 0.1*h);
					    
					    // draw rectanles
					    drawRectangle(0.01*w, 0.4*h, 0.05*w, 0.2*h, "yellow"); 
					    drawRectangle(0.94*w, 0.4*h, 0.05*w, 0.2*h, "blue");
					    
					    // draw player
					    drawPlayer(0.1*w, 0.3*h, 20, "BOT 0", TEAM_YELLOW);
					    drawPlayer(0.5*w, 0.6*h, 80, "BOT 1", TEAM_BLUE);
					    drawPlayer(0.8*w, 0.6*h, 250, "BOT 2", TEAM_NONE);
					    
					    // draw ball
					    drawBall(0.6*w, 0.4*h);
					    
	        		};
	        		
	        		// call canvas update function
	        		updateCanvas();
				    
			  	</script>
	        	
	        	
	        	<form class="list" id="newGameForm">         		       		
	        		<span class="listEntry">
	        			<span class="listEntryElement">
	        				Gamename: <input type="text" value="NewGame" size="16" id="newConnectionGamename" />
	        				IP: <input type="text" value="127.0.0.1" size="12" id="newConnectionIP" />
	        				Port: <input type="text" id="newConnectionPort" value="9060" size="3" />
	        			</span>
	        			<span class="button"><input type="submit" class="button" id="newGameConnect" value="New Game" /></span>
	        		</span>        		
	        	</form>
	        	
	        	<div class="list", id="gameList">
		        	<span class="listEntry" id="game1">
		        		<span class="listEntryElement">Game 1: Maus vs. Elefant<br /><i>Status: playing</i></span>
		        		<span class="button">Join</span>
		        	</span>
		        	<span class="listEntry" id="game2">
		        		<span class="listEntryElement">Game 2: Pe vs. Nis<br /><i>Status: kickoff</i></span>
		        		<span class="button">Join</span>
		        	</span>
		        	<span class="listEntry" id="game3">
		        		<span class="listEntryElement">Game 2: Pe vs. Nis<br /><i>Status: kickoff</i></span>
		        		<span class="button">Join</span>
		        	</span>
		        	<span class="listEntry" id="game4">
		        		<span class="listEntryElement">Game 2: Pe vs. Nis<br /><i>Status: kickoff</i></span>
		        		<span class="button">Join</span>
		        	</span>
	        	</div>
	        	<!-- CONTENT END -->
	        </div>
        </div>
        <div id="footerwrap">
	        <div id="footer">
	            <span id="mr-subtitle">&copy;2013 by <a href="http://www.northern-stars.de">NorthernStars</a></span>
	        </div>
        </div>
    </div>
    
    <div class="overlay" id="login">
	    <div class="overlayWrapper">
	    	<form class="overlayForm" id="loginForm">	    	
	    		<div class="overlayCancel" id="loginCancel">X</div>
	    		<div class="overlayRow">
	    			<div class="overlayFormEntry">Username:</div>
	    		</div>
	    		<div class="overlayRow">
	    			<div class="overlayFormEntry"><input type="text" class="textInput" id="loginUsername" /></div>
	    		</div>
	    		<div class="overlayRow">
	    			<div class="overlayFormEntry">Password:</div>
	    		</div>
	    		<div class="overlayRow">
	    			<div class="overlayFormEntry"><input type="password" class="textInput" id="loginPassword" /></div>
	    		</div>
	    		<div class="overlayRow"><div class="overlayFormEntry"> </div></div>
	    		<div class="overlayRow">
	    			<input type="submit" class="button" id="loginSubmit" value="Login" />
	    		</div>	    		
	    	</form>
	    </div>
	</div>
	
  </body>
</html>
